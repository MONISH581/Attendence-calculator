<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Login — MyShakthiview</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
    body { font-family: 'Inter', sans-serif; background-color: #f9fafb;}
    /* Responsive padding and font size for login role buttons */
    @media (max-width: 400px) {
      #login-app .role-btn {
        padding-left: 0.5rem;
        padding-right: 0.5rem;
        font-size: 0.75rem;
      }
    }
  </style>
</head>
<body class="bg-gray-50 flex items-center justify-center min-h-screen p-4">
  <div id="login-app" class="w-full max-w-md">
    <div class="bg-white rounded-2xl shadow-2xl p-8 sm:p-10 border-t-4 border-sky-700">
      <header class="text-center mb-8">
        <h1 class="text-2xl font-extrabold text-gray-900 tracking-tight">Myshakthiview — Digital Attendance</h1>
        <p class="text-gray-500 mt-2">Unified Portal — Please sign in</p>
      </header>
      <div class="mb-6 flex space-x-2 p-1 bg-gray-100 rounded-full">
        <!-- Improved: uniform padding and role-btn class for all -->
        <button id="roleStudent" class="role-btn flex-1 px-4 py-2 text-sm font-semibold rounded-full bg-sky-600 text-white shadow-md transition-colors duration-200">Student Login</button>
        <button id="roleTeacher" class="role-btn flex-1 px-4 py-2 text-sm font-semibold rounded-full text-gray-700 hover:bg-sky-100 hover:text-sky-700 transition-colors duration-200">Teacher Login</button>
        <button id="roleAdmin" class="role-btn flex-1 px-4 py-2 text-sm font-semibold rounded-full text-gray-700 hover:bg-sky-100 hover:text-sky-700 transition-colors duration-200">Admin Login</button>
        <button id="roleSuperadmin" class="role-btn flex-1 px-3 py-2 text-sm font-semibold rounded-full text-gray-700 hover:bg-sky-100 hover:text-sky-700 transition-colors duration-200">Superadmin Login</button>
      </div>
      <div class="grid gap-4">
        <label for="loginIdentifier" class="text-sm font-medium text-gray-700" id="identifierLabel">Roll No</label>
        <input id="loginIdentifier" class="border border-gray-300 rounded-xl px-4 py-2.5" placeholder="Enter your Roll Number"/>
        <label for="loginPassword" class="text-sm font-medium text-gray-700">Password/Key</label>
        <input id="loginPassword" type="password" class="border border-gray-300 rounded-xl px-4 py-2.5" placeholder="Enter your secret key"/>
        <button id="loginButton" class="mt-4 w-full px-6 py-3 rounded-xl bg-sky-600 text-white font-bold shadow-lg hover:bg-sky-700">Sign In</button>
      </div>
      <p class="text-center text-xs text-gray-500 mt-6">Need access? Contact your administrator.</p>
      <div id="messageBoxContainer"></div>
    </div>
  </div>
<script>
function displayTemporaryMessage(message, type = 'blue') {
  const container = document.getElementById('messageBoxContainer');
  container.innerHTML = '';
  const colorClasses = {
    'green': 'bg-green-100 border-green-400 text-green-700',
    'red': 'bg-red-100 border-red-400 text-red-700',
    'blue': 'bg-blue-100 border-blue-400 text-blue-700'
  };
  const msgEl = document.createElement('div');
  msgEl.className = `fixed bottom-4 right-4 z-50 p-4 rounded-xl shadow-lg border-l-4 ${colorClasses[type]} transition-opacity duration-300`;
  msgEl.textContent = message;
  container.appendChild(msgEl);
  setTimeout(() => {
    msgEl.classList.add('opacity-0');
    setTimeout(() => msgEl.remove(), 300);
  }, 3000);
}

document.addEventListener('DOMContentLoaded', () => {
  let currentRole = 'student';
  const roleStudentBtn = document.getElementById('roleStudent');
  const roleTeacherBtn = document.getElementById('roleTeacher');
  const adminBtn = document.getElementById('roleAdmin');
  const superAdminBtn = document.getElementById('roleSuperadmin');
  const loginIdentifierInput = document.getElementById('loginIdentifier');
  const identifierLabel = document.getElementById('identifierLabel');
  const loginButton = document.getElementById('loginButton');
  const allRoleBtns = [roleStudentBtn, roleTeacherBtn, adminBtn, superAdminBtn];

  function switchRole(role) {
    currentRole = role;
    // Remove active styling from all, add to selected
    allRoleBtns.forEach(b => {
      b.classList.remove('bg-sky-600', 'text-white', 'shadow-md');
      b.classList.add('text-gray-700');
    });
    let selectedBtn;
    if (role === 'student') {
      selectedBtn = roleStudentBtn;
      identifierLabel.textContent = 'Roll No';
      loginIdentifierInput.placeholder = 'Enter your Roll Number';
    } else {
      if (role === 'teacher') selectedBtn = roleTeacherBtn;
      if (role === 'admin') selectedBtn = adminBtn;
      if (role === 'superadmin') selectedBtn = superAdminBtn;
      identifierLabel.textContent = 'Email';
      loginIdentifierInput.placeholder = 'Enter your Email';
    }
    selectedBtn.classList.add('bg-sky-600', 'text-white', 'shadow-md');
    selectedBtn.classList.remove('text-gray-700');
    loginIdentifierInput.value = '';
    document.getElementById('loginPassword').value = '';
  }

  switchRole(currentRole);
  roleStudentBtn.addEventListener('click', () => switchRole('student'));
  roleTeacherBtn.addEventListener('click', () => switchRole('teacher'));
  adminBtn.addEventListener('click', () => switchRole('admin'));
  superAdminBtn.addEventListener('click', () => switchRole('superadmin'));

  loginButton.addEventListener('click', async (e) => {
    e.preventDefault();
    loginButton.disabled = true;
    loginButton.classList.add('opacity-50', 'cursor-not-allowed');
    const identifier = loginIdentifierInput.value.trim();
    const password = document.getElementById('loginPassword').value.trim();
    if (!identifier || !password) {
      displayTemporaryMessage("Please enter your identifier and password/key.", 'red');
      loginButton.disabled = false;
      loginButton.classList.remove('opacity-50', 'cursor-not-allowed');
      return;
    }
    let endpoint, payload;
    if (currentRole === 'student') {
      endpoint = 'http://localhost:5000/api/students/login';
      payload = { rollNo: identifier, password };
    } else if (currentRole === 'teacher') {
      endpoint = 'http://localhost:5000/api/teachers/login';
      payload = { email: identifier, password };
    } else if (currentRole === 'admin' || currentRole === 'superadmin') {
      endpoint = 'http://localhost:5000/api/admins/login';
      payload = { email: identifier, password };
    }
    try {
      const res = await fetch(endpoint, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });
      const resp = await res.json().catch(() => ({}));
      if (!res.ok) throw new Error(resp.message || 'Login failed');
      localStorage.setItem('userId', resp.userId);
      localStorage.setItem('userRole', resp.role);
      localStorage.setItem('userName', resp.name);
      displayTemporaryMessage('Login successful. Redirecting...', 'green');
      setTimeout(() => {
        if (resp.role === 'admin') window.location.href = './admin.html';
        else if (resp.role === 'superadmin') window.location.href = './superadmin.html';
        else if (resp.role === 'teacher') window.location.href = './teacher.html';
        else window.location.href = './student-dashboard.html';
      }, 700);
    } catch (err) {
      displayTemporaryMessage(err.message || 'Login failed', 'red');
    } finally {
      loginButton.disabled = false;
      loginButton.classList.remove('opacity-50', 'cursor-not-allowed');
    }
  });
});
</script>
</body>
</html>
